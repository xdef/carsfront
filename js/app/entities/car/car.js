var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,slice=[].slice;define(["app/app","base.entities","./photo"],function(t,e){return t.module("Entities",function(t,e,r,n,o,a){var s;return t.Car=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n.prototype.localStorage=new r.LocalStorage("Cars"),n.prototype.defaults={createdAt:moment().toISOString()},n.prototype.relations=[{key:"photos",relatedModel:function(){return t.Photo},collectionType:function(){return t.PhotosCollection}}],n.prototype.validate=function(t,e){var r,n;return null==e&&(e={}),r=[],a.isEmpty(t.model)&&r.push({attr:"model",msg:["Модель"]}),a.isEmpty(t.price)&&r.push({attr:"price",msg:["Стоимость"]}),a.isEmpty(t.year)&&r.push({attr:"year",msg:["Год выпуска"]}),a.isEmpty(t.description)&&r.push({attr:"description",msg:["Описание"]}),n=r.length?r:void 0},n}(t.RelationalModel),t.CarsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n.prototype.model=t.Car,n.prototype.localStorage=new r.LocalStorage("Cars"),n.prototype.comparator=function(t){return this._sortByReverse_createdAt(t)},n.prototype._sortBy_createdAt=function(t){return new Date(t.get("createdAt"))},n.prototype._sortByReverse_createdAt=function(t){return-new Date(t.get("createdAt"))},n.prototype._sortBy_price=function(t){return new Number(t.get("price"))},n.prototype._sortByReverse_price=function(t){return-new Number(t.get("price"))},n}(t.Collection),s={newCar:function(e){return null==e&&(e={}),new t.Car(e)},getCars:function(e){var r,n;return null==e&&(e={}),this.cars||(this.cars=new t.CarsCollection),this.cars.fetch(),(n=e.size)?(r=new t.CarsCollection(this.cars.models.slice(0,n)),r.total=this.cars.length,r):this.cars},getCar:function(t,r){return null==r&&(r={}),this.cars||(this.cars=e.reqres.request("car:entities")),this.cars.get(t)},createCar:function(t,r){return null==r&&(r={}),t.isValid()?(r=a.defaults(r,{success:function(t,r,n){return e.navigate("/car",{trigger:!0})},error:function(t,e,r){return console.log("error")}}),t.save({},r)):void 0},destroyCar:function(t,r){var n;return null==r&&(r={}),r=a.defaults(r,{success:function(t,r,n){return e.navigate("/car",{trigger:!0})},error:function(t,e,r){}}),n=e.reqres.request("alert:window",{header:"Удалить автомобиль",message:"Вы уверены, что хотите удалить автомобиль из локальной базы данных Вашего браузера?"}),n.on("approve",function(){return t.destroy(r)}),n.on("deny",function(){})},resortCars:function(t,e){var r,n,o;if(o=e.get("direction")>0?"":"Reverse",r=e.get("sort_by"),n="_sortBy"+o+"_"+r,!a.isFunction(t[n]))throw"Comparator function should be exist in CarsCollection: "+n;return t.comparator=t[n],t.sort()},populateCars:function(t){return require(["app/entities/car/data"],function(r){return t||(t=e.reqres.request("car:entities")),a.each(r,function(e){return t.create(e)}),window.location.reload()})}},e.reqres.setHandler("car:entities",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.getCars.apply(s,t)}),e.reqres.setHandler("car:entity",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.getCar.apply(s,t)}),e.reqres.setHandler("car:entity:new",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.newCar.apply(s,t)}),e.commands.setHandler("car:entity:create",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.createCar.apply(s,t)}),e.commands.setHandler("car:entity:destroy",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.destroyCar.apply(s,t)}),e.commands.setHandler("car:entities:resort",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.resortCars.apply(s,t)}),e.commands.setHandler("car:entities:populate",function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],s.populateCars.apply(s,t)})})});