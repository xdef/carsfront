var slice=[].slice;define(["app/app"],function(e){var n,t;return n=Backbone.sync,Backbone.sync=function(r,a,c){var o,i,l;return null==c&&(c={}),_.defaults(c,{beforeSend:_.bind(t.beforeSend,a),complete:_.bind(t.complete,a)}),o=c.error,c.error=function(){var n,t;return n=1<=arguments.length?slice.call(arguments,0):[],o&&o.apply(null,n),(t=e.vent).trigger.apply(t,["model:error",a].concat(slice.call(n)))},null!==c.data||!a||"create"!==r&&"update"!==r&&"patch"!==r||(c.contentType="application/json",a.paramRoot&&(i={},i[a.paramRoot]=a.toJSON(c)),i||(i=a.toJSON(c)),c.data=JSON.stringify(i)),l=n(r,a,c),a._fetch?void 0:a._fetch=l.promise()},t={beforeSend:function(){return this.trigger("sync:start",this)},complete:function(){return this.trigger("sync:stop",this)}},e.module("Entities",function(e,n,t,r,a,c){return n.commands.setHandler("when:fetched",function(e,n){var t;return t=c.chain([e]).flatten().pluck("_fetch").value(),a.when.apply(a,t).done(function(){return n()})})})});